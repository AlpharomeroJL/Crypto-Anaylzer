<?plantuml 1.2026.1?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="DESCRIPTION" height="529px" preserveAspectRatio="none" style="width:1440px;height:529px;background:#FFFFFF;" version="1.1" viewBox="0 0 1440 529" width="1440px" zoomAndPan="magnify"><title>Schema Overview &#8212; Core, V2, Phase 3 (Opt-in) (ebb8e37)</title><defs/><g><g class="title" data-source-line="1"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="313.9883" x="556.2212" y="24.5332">Schema Overview &#8212; Core, V2, Phase 3 (Opt-in)</text></g><!--cluster Core (run_migrations)--><g class="cluster" data-qualified-name="Core .run_migrations." data-source-line="3" id="ent0002"><path d="M1175.5,44.6094 L1323.5137,44.6094 A3.75,3.75 0 0 1 1326.0137,47.1094 L1333.0137,68.2188 L1366.5,68.2188 A2.5,2.5 0 0 1 1369,70.7188 L1369,211.1494 A2.5,2.5 0 0 1 1366.5,213.6494 L1175.5,213.6494 A2.5,2.5 0 0 1 1173,211.1494 L1173,47.1094 A2.5,2.5 0 0 1 1175.5,44.6094" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1173" x2="1333.0137" y1="68.2188" y2="68.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="147.0137" x="1177" y="61.1426">Core (run_migrations)</text></g><!--cluster V2 (run_migrations_v2)--><g class="cluster" data-qualified-name="V2 .run_migrations_v2." data-source-line="7" id="ent0004"><path d="M795.5,263.6494 L952.0996,263.6494 A3.75,3.75 0 0 1 954.5996,266.1494 L961.5996,287.2588 L1383.5,287.2588 A2.5,2.5 0 0 1 1386,289.7588 L1386,519.9794 A2.5,2.5 0 0 1 1383.5,522.4794 L795.5,522.4794 A2.5,2.5 0 0 1 793,519.9794 L793,266.1494 A2.5,2.5 0 0 1 795.5,263.6494" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="793" x2="961.5996" y1="287.2588" y2="287.2588"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="155.5996" x="797" y="280.1826">V2 (run_migrations_v2)</text></g><!--cluster Phase3--><g class="cluster" data-qualified-name="Phase3" data-source-line="18" id="ent0013"><path d="M8.5,71.8194 L276.334,71.8194 A3.75,3.75 0 0 1 278.834,74.3194 L285.834,95.4287 L535.5,95.4287 A2.5,2.5 0 0 1 538,97.9287 L538,385.3694 A2.5,2.5 0 0 1 535.5,387.8694 L8.5,387.8694 A2.5,2.5 0 0 1 6,385.3694 L6,74.3194 A2.5,2.5 0 0 1 8.5,71.8194" fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="6" x2="285.834" y1="95.4287" y2="95.4287"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="266.834" x="10" y="88.3526">Phase3 (run_migrations_phase3, opt-in)</text></g><!--entity Core--><g class="entity" data-qualified-name="Core .run_migrations..Core" data-source-line="4" id="ent0003"><path d="M1189.01,90.6094 C1189.01,80.6094 1270.9958,80.6094 1270.9958,80.6094 C1270.9958,80.6094 1352.9817,80.6094 1352.9817,90.6094 L1352.9817,187.6563 C1352.9817,197.6563 1270.9958,197.6563 1270.9958,197.6563 C1270.9958,197.6563 1189.01,197.6563 1189.01,187.6563 L1189.01,90.6094" fill="#F1F1F1" style="stroke:#181818;stroke-width:0.5;"/><path d="M1189.01,90.6094 C1189.01,100.6094 1270.9958,100.6094 1270.9958,100.6094 C1270.9958,100.6094 1352.9817,100.6094 1352.9817,90.6094" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="136.1992" x="1199.01" y="119.1426">spot_price_snapshots</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="143.9717" x="1199.01" y="136.752">sol_monitor_snapshots</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.7168" x="1199.01" y="154.3613">universe_allowlist</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122.1924" x="1199.01" y="171.9707">universe_churn_log</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96.5098" x="1199.01" y="189.5801">provider_health</text></g><!--entity SM--><g class="entity" data-qualified-name="V2 .run_migrations_v2..SM" data-source-line="8" id="ent0005"><path d="M809.31,318.4594 C809.31,308.4594 880.0029,308.4594 880.0029,308.4594 C880.0029,308.4594 950.6957,308.4594 950.6957,318.4594 L950.6957,345.0688 C950.6957,355.0688 880.0029,355.0688 880.0029,355.0688 C880.0029,355.0688 809.31,355.0688 809.31,345.0688 L809.31,318.4594" fill="#F1F1F1" style="stroke:#181818;stroke-width:0.5;"/><path d="M809.31,318.4594 C809.31,328.4594 880.0029,328.4594 880.0029,328.4594 C880.0029,328.4594 950.6957,328.4594 950.6957,318.4594" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121.3857" x="819.31" y="346.9926">schema_migrations</text></g><!--entity FMR--><g class="entity" data-qualified-name="V2 .run_migrations_v2..FMR" data-source-line="9" id="ent0006"><path d="M985.65,309.6494 C985.65,299.6494 1061.005,299.6494 1061.005,299.6494 C1061.005,299.6494 1136.36,299.6494 1136.36,309.6494 L1136.36,353.8681 C1136.36,363.8681 1061.005,363.8681 1061.005,363.8681 C1061.005,363.8681 985.65,363.8681 985.65,353.8681 L985.65,309.6494" fill="#F1F1F1" style="stroke:#181818;stroke-width:0.5;"/><path d="M985.65,309.6494 C985.65,319.6494 1061.005,319.6494 1061.005,319.6494 C1061.005,319.6494 1136.36,319.6494 1136.36,309.6494" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115.9512" x="995.65" y="338.1826">factor_model_runs</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130.71" x="995.65" y="355.792">(deterministic run_id)</text></g><!--entity FB--><g class="entity" data-qualified-name="V2 .run_migrations_v2..FB" data-source-line="10" id="ent0007"><path d="M948.48,469.8694 C948.48,459.8694 997.0039,459.8694 997.0039,459.8694 C997.0039,459.8694 1045.5279,459.8694 1045.5279,469.8694 L1045.5279,496.4788 C1045.5279,506.4788 997.0039,506.4788 997.0039,506.4788 C997.0039,506.4788 948.48,506.4788 948.48,496.4788 L948.48,469.8694" fill="#F1F1F1" style="stroke:#181818;stroke-width:0.5;"/><path d="M948.48,469.8694 C948.48,479.8694 997.0039,479.8694 997.0039,479.8694 C997.0039,479.8694 1045.5279,479.8694 1045.5279,469.8694" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77.0479" x="958.48" y="498.4026">factor_betas</text></g><!--entity RR--><g class="entity" data-qualified-name="V2 .run_migrations_v2..RR" data-source-line="11" id="ent0008"><path d="M1080.81,469.8694 C1080.81,459.8694 1141.0029,459.8694 1141.0029,459.8694 C1141.0029,459.8694 1201.1957,459.8694 1201.1957,469.8694 L1201.1957,496.4788 C1201.1957,506.4788 1141.0029,506.4788 1141.0029,506.4788 C1141.0029,506.4788 1080.81,506.4788 1080.81,496.4788 L1080.81,469.8694" fill="#F1F1F1" style="stroke:#181818;stroke-width:0.5;"/><path d="M1080.81,469.8694 C1080.81,479.8694 1141.0029,479.8694 1141.0029,479.8694 C1141.0029,479.8694 1201.1957,479.8694 1201.1957,469.8694" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100.3857" x="1090.81" y="498.4026">residual_returns</text></g><!--entity Bars--><g class="entity" data-qualified-name="V2 .run_migrations_v2..Bars" data-source-line="12" id="ent0009"><path d="M1171.52,318.4594 C1171.52,308.4594 1271.0024,308.4594 1271.0024,308.4594 C1271.0024,308.4594 1370.4848,308.4594 1370.4848,318.4594 L1370.4848,345.0688 C1370.4848,355.0688 1271.0024,355.0688 1271.0024,355.0688 C1271.0024,355.0688 1171.52,355.0688 1171.52,345.0688 L1171.52,318.4594" fill="#F1F1F1" style="stroke:#181818;stroke-width:0.5;"/><path d="M1171.52,318.4594 C1171.52,328.4594 1271.0024,328.4594 1271.0024,328.4594 C1271.0024,328.4594 1370.4848,328.4594 1370.4848,318.4594" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="178.9648" x="1181.52" y="346.9926">bars_* (5min, 15min, 1h, 1D)</text></g><!--entity SM3--><g class="entity" data-qualified-name="Phase3.SM3" data-source-line="19" id="ent0014"><path d="M154.45,125.8194 C154.45,115.8194 252.0013,115.8194 252.0013,115.8194 C252.0013,115.8194 349.5525,115.8194 349.5525,125.8194 L349.5525,152.4287 C349.5525,162.4287 252.0013,162.4287 252.0013,162.4287 C252.0013,162.4287 154.45,162.4287 154.45,152.4287 L154.45,125.8194" fill="#F1F1F1" style="stroke:#181818;stroke-width:0.5;"/><path d="M154.45,125.8194 C154.45,135.8194 252.0013,135.8194 252.0013,135.8194 C252.0013,135.8194 349.5525,135.8194 349.5525,125.8194" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="175.1025" x="164.45" y="154.3526">schema_migrations_phase3</text></g><!--entity Regime--><g class="entity" data-qualified-name="Phase3.Regime" data-source-line="20" id="ent0015"><path d="M30.03,309.6494 C30.03,299.6494 83.9953,299.6494 83.9953,299.6494 C83.9953,299.6494 137.9607,299.6494 137.9607,309.6494 L137.9607,353.8681 C137.9607,363.8681 83.9953,363.8681 83.9953,363.8681 C83.9953,363.8681 30.03,363.8681 30.03,353.8681 L30.03,309.6494" fill="#F1F1F1" style="stroke:#181818;stroke-width:0.5;"/><path d="M30.03,309.6494 C30.03,319.6494 83.9953,319.6494 83.9953,319.6494 C83.9953,319.6494 137.9607,319.6494 137.9607,309.6494" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77.8135" x="40.03" y="338.1826">regime_runs</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.9307" x="40.03" y="355.792">regime_states</text></g><!--entity Prom--><g class="entity" data-qualified-name="Phase3.Prom" data-source-line="21" id="ent0016"><path d="M173.12,309.6494 C173.12,299.6494 251.9989,299.6494 251.9989,299.6494 C251.9989,299.6494 330.8778,299.6494 330.8778,309.6494 L330.8778,353.8681 C330.8778,363.8681 251.9989,363.8681 251.9989,363.8681 C251.9989,363.8681 173.12,363.8681 173.12,353.8681 L173.12,309.6494" fill="#F1F1F1" style="stroke:#181818;stroke-width:0.5;"/><path d="M173.12,309.6494 C173.12,319.6494 251.9989,319.6494 251.9989,319.6494 C251.9989,319.6494 330.8778,319.6494 330.8778,309.6494" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137.7578" x="183.12" y="338.1826">promotion_candidates</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111.2891" x="183.12" y="355.792">promotion_events</text></g><!--entity Sweep--><g class="entity" data-qualified-name="Phase3.Sweep" data-source-line="22" id="ent0017"><path d="M366.07,309.6494 C366.07,299.6494 436.0007,299.6494 436.0007,299.6494 C436.0007,299.6494 505.9313,299.6494 505.9313,309.6494 L505.9313,353.8681 C505.9313,363.8681 436.0007,363.8681 436.0007,363.8681 C436.0007,363.8681 366.07,363.8681 366.07,353.8681 L366.07,309.6494" fill="#F1F1F1" style="stroke:#181818;stroke-width:0.5;"/><path d="M366.07,309.6494 C366.07,319.6494 436.0007,319.6494 436.0007,319.6494 C436.0007,319.6494 505.9313,319.6494 505.9313,309.6494" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95.71" x="376.07" y="338.1826">sweep_families</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119.8613" x="376.07" y="355.792">sweep_hypotheses</text></g><g class="entity" data-qualified-name="GMN21" data-source-line="29" id="ent0022"><path d="M561.59,302.2294 L561.59,361.2841 L774.4162,361.2841 L774.4162,312.2294 L764.4162,302.2294 L561.59,302.2294" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M764.4162,302.2294 L764.4162,312.2294 L774.4162,312.2294 L764.4162,302.2294" fill="#FEFFDD" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.3652" x="567.59" y="320.7245">Not applied by default.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191.8262" x="567.59" y="337.0761">ENABLE_REGIMES=1 or explicit</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.6416" x="567.59" y="353.4276">promotion/sweep usage.</text></g><!--link Core to Bars--><g class="link" data-entity-1="ent0003" data-entity-2="ent0009" data-link-type="dependency" data-source-line="14" id="lnk10"><path d="M1271,198.0994 C1271,235.1294 1271,275.0794 1271,302.0394" fill="none" id="Core-to-Bars" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1271,308.0394,1275,299.0394,1271,303.0394,1267,299.0394,1271,308.0394" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160.4307" x="1272" y="244.1445">bar builder reads snapshots</text></g><!--link FMR to FB--><g class="link" data-entity-1="ent0006" data-entity-2="ent0007" data-link-type="dependency" data-source-line="15" id="lnk11"><path d="M1047.41,364.3194 C1041.18,378.7994 1033.71,396.1994 1027,411.8694 C1020.21,427.7294 1014.9343,440.0906 1009.0643,453.8506" fill="none" id="FMR-to-FB" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1006.71,459.3694,1013.9207,452.6607,1008.6719,454.7704,1006.5623,449.5216,1006.71,459.3694" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36.1372" x="1028" y="426.3645">run_id</text></g><!--link FMR to RR--><g class="link" data-entity-1="ent0006" data-entity-2="ent0008" data-link-type="dependency" data-source-line="16" id="lnk12"><path d="M1077.77,364.0794 C1093.07,392.6594 1112.4872,428.9202 1126.1072,454.3502" fill="none" id="FMR-to-RR" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1128.94,459.6394,1128.2169,449.8171,1126.5793,455.2317,1121.1647,453.5942,1128.94,459.6394" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36.1372" x="1113.84" y="426.3645">run_id</text></g><!--link SM3 to Regime--><g class="link" data-entity-1="ent0014" data-entity-2="ent0015" data-link-type="dependency" data-source-line="24" id="lnk18"><path d="M232.07,162.7494 C202.17,196.6694 149.5774,256.3583 115.6774,294.8183" fill="none" id="SM3-to-Regime" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="111.71,299.3194,120.6618,295.2127,115.0162,295.5685,114.6604,289.9228,111.71,299.3194" style="stroke:#181818;stroke-width:1;"/></g><!--link SM3 to Prom--><g class="link" data-entity-1="ent0014" data-entity-2="ent0016" data-link-type="dependency" data-source-line="25" id="lnk19"><path d="M252,162.7494 C252,196.6694 252,254.8594 252,293.3194" fill="none" id="SM3-to-Prom" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="252,299.3194,256,290.3194,252,294.3194,248,290.3194,252,299.3194" style="stroke:#181818;stroke-width:1;"/></g><!--link SM3 to Sweep--><g class="link" data-entity-1="ent0014" data-entity-2="ent0017" data-link-type="dependency" data-source-line="26" id="lnk20"><path d="M273.83,162.7494 C306.58,196.6694 364.3632,256.5422 401.4832,295.0022" fill="none" id="SM3-to-Sweep" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="405.65,299.3194,402.278,290.0658,402.1777,295.7217,396.5217,295.6214,405.65,299.3194" style="stroke:#181818;stroke-width:1;"/></g><!--link Phase3 to GMN21--><g class="link" data-entity-1="ent0013" data-entity-2="ent0022" data-link-type="association" data-source-line="29" id="lnk23"><path d="M538.2021,151.4628 C538.4032,151.7405 538.6074,152.0227 538.8149,152.3092 C540.4746,154.6018 542.3375,157.1752 544.3767,159.9919 C552.5334,171.2588 563.5094,186.4194 575.5688,203.0769 C599.6875,236.3919 628.14,275.6944 647.04,301.8094" fill="none" id="Phase3-GMN21" style="stroke:#181818;stroke-width:1;stroke-dasharray:7,7;"/></g><?plantuml-src XLB1Qjj04BthAmQVx6AdnAQNGWjrQvT2dGGRSWei8-tOMhhQ5RiZkw4K-X7zmdv9Hol5iPD03iRCs_TctZmD6xO4cwAa2k5wJs5lw03__lo5ppxG66wdOxWfCHBCO7XTyyIuKPRLMFp07S6W9S4mD4vLPXUGZNTnD81V6O16nhmL3cBjMTN15AIYmpgMdkETYzwgoZl3Ffp2ZJFY8f92Q_t1ciWdM54smIdhTtUk3dvlD0LL4bek1u0nMSv-dzYxdJurf_RJv_xIzYUar6opEYDjiMYTLbwJLT9Jh0urCONAE35f2cW76JrAukLg_P8w9yQk-t9-zXue6jsWT2QM5JlE-hn7ZY6gDp1y9nF7SDd_bVBxqWsT2q7MJzzaClcOQdWFeeEyCLR2Wa2e8npZpiHdeYxdGkmME6BhzIFs66awXjcpMEi4Zy5t9vByzDHNmkwbVUQp9x7iJ4Lzt7qH6PdwW19off2pg7pRLnNejD4jDnrBZzAU77Vg6m7FhHs8QhN5obZJghgwl9VpBIdsCpSjA2cBrIwbpiD3cPe-51qtSvu9Si_iA_3RFXQPVEKPiAvbc8Ry7ZHjiR5y8I-Bgq_pxmkrNdpzjbfiFbo23q0_XLaObkVZEc-JHMYYV9gBZ9o6TbRs7m00?></g></svg>