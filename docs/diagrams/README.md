# Architecture Diagrams

Diagrams are maintained as PlantUML (`.puml`). Exports to SVG and PNG are generated by `scripts/export_diagrams.ps1` (recursively, including subfolders) and committed for portability. Keep diagrams aligned with code when architecture changes (providers, chain, resilience, DB, Phase 3); see project rule "Docs as Source of Truth → Diagrams".

To generate SVG/PNG from the repo root:

```powershell
powershell -NoProfile -ExecutionPolicy Bypass -File .\scripts\export_diagrams.ps1
```

Or use the VS Code "PlantUML" extension and "Export current diagram".

---

## Root-level diagrams (legacy layout)

| Diagram | View Type | Purpose |
|---------|-----------|---------|
| [architecture_context.svg](architecture_context.svg) | Context | System boundary and externals |
| [architecture_internal.svg](architecture_internal.svg) | Container | Internal layering and data flow |
| [providers_subsystem.svg](providers_subsystem.svg) | Logical | Provider interfaces and resilience |
| [ingestion_sequence.svg](ingestion_sequence.svg) | Behavioral | Single poll execution path |
| [research_lifecycle.svg](research_lifecycle.svg) | State | Research pipeline lifecycle |

---

## Diagrams by area (new layout)

New diagrams reflecting Phase 1–3 implementation (ValidationBundle, factor/regime materialize, promotion workflow, sweep registry, execution evidence, caching) live in subfolders. The export script writes SVG/PNG next to each `.puml` in the same folder.

### architecture/

| Diagram | Purpose |
|---------|---------|
| [architecture/pipeline_overview.svg](architecture/pipeline_overview.svg) | Four stages (Ingestion → Materialization → Modeling → Presentation) and Phase 3 opt-in paths (regime, promotion, sweep). |

### research/

| Diagram | Purpose |
|---------|---------|
| [research/reportv2_pipeline.svg](research/reportv2_pipeline.svg) | Report v2 flow: optional `--factor-run-id`, `--regimes`, `--reality-check`, `--execution-evidence`; ValidationBundle emission; sweep persist; promotion evaluate. |

### promotion/

| Diagram | Purpose |
|---------|---------|
| [promotion/promotion_workflow.svg](promotion/promotion_workflow.svg) | Promotion workflow (exploratory → candidate → accepted/rejected); store, service, gating (RC, regime, execution evidence); RC/factor/regime caches; CLI and Streamlit. |

### data/

| Diagram | Purpose |
|---------|---------|
| [data/schema_overview.svg](data/schema_overview.svg) | Schema layers: core (snapshots, allowlist, health), V2 (factor_model_runs, factor_betas, residual_returns), Phase 3 opt-in (regime_runs/states, promotion_candidates/events, sweep_families/hypotheses). |
